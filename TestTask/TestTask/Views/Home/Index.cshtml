@{
    ViewBag.Title = "Home Page";
}



<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script>
    function Loading(this1) {
        this1.innerHTML = '<i class="fa fa-spinner fa-spin, form"></i> Loading...';
    }
</script>


<style>

    .table-head {
        background-color: #454d55;
        color: white;
        text-align: center;
    }

    .fixed_header {
        width: 100%;
        table-layout: fixed;
    }

    .fixed_header tbody {
        display: block;
        width: 100%;
        overflow: auto;
        height: 45vh;
    }

    .fixed_header thead tr {
        display: block;
    }

    .fixed_header th, .fixed_header td {
        width: 100%;
    }

</style>



<div class="align-items-center">

    <form action="Index" method="post">

        <!--Charts-->
        <div class="col">

            <!--chart is visible if url was calculated-->
            <div id="chart1" style="height: 30vh; visibility: @if (ViewBag.url == "") { <text>hidden</text> } else { <text>visible</text>} "></div>

            <!-- you need to include the shieldui css and js assets in order for the charts to work -->
            <link rel="stylesheet" type="text/css" href="https://www.shieldui.com/shared/components/latest/css/light-bootstrap/all.min.css" />
            <script type="text/javascript" src="https://www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"></script>

            <script type="text/javascript">

                jQuery(function ($) {

                    var data1 = [];
                    var values1 = [];

                    @{ var id = 1;}
                    @foreach (var item in ViewBag.siteMap)
                    {
                        if (item.requestTimeMid != "No Respond")
                        {
                            <text>data1.push(parseFloat(@item.requestTimeMid));</text>
                            <text>values1.push(parseFloat(@id));</text>
                        }
                        { id++; }
                    }

                    $("#chart1").shieldChart({
                    primaryHeader: {
                        text: "Response chart"
                        },
                        exportOptions: {
                        image: false,
                            print: false
                        },
                        axisX: {
                            categoricalValues: values1
                        },
                        dataSeries: [{
                        seriesType: "bar",
                            collectionAlias: "Time of response",
                            data: data1
                        }]
                    });

                });

            </script>


        </div>


        <!--URL input-->
        <div class="col">

            <input type="text" class="form-control" placeholder="URL" name="url" value="@ViewBag.url" style="float: left; width: 85%">
            
            <!--Submit-->
            <button type="submit" class="btn btn-success" style="float: right; width: 15%" onclick="Loading(this);">Start</button>

            <!--if URL is not valid => show info about it-->
            <h4 class="text-danger">@ViewBag.error</h4>


        </div>


        <!--Results Table (visible if url calculated)-->
        <div class="col" style="margin-top: 50px; visibility: @if (ViewBag.url == "") { <text>hidden</text> } else { <text>visible</text>}">

            <table class="table, fixed_header">
                <thead>
                    <tr class="table-head">

                        <!--Headers-->
                        <th scope="col" style="text-align: center; width: 5vw">
                            №
                        </th>
                        <th scope="col" style="text-align: center; width: 35vw">
                            URL
                        </th>
                        <th scope="col" style="text-align: center; width: 20vw">
                            MID Response time
                        </th>
                        <th scope="col" style="text-align: center; text-wrap: normal; width: 20vw">
                            MIN Response time
                        </th>
                        <th scope="col" style="text-align: center; text-wrap: normal; width: 20vw">
                            MAX Response time
                        </th>

                    </tr>
                </thead>
                <tbody>

                    <!--Data output-->
                    @{ var counter = 1; }
                    @foreach (var item in ViewBag.siteMap)
                    {
                        <tr>
                            <th scope="row" style="text-align: center; width: 5vw">@counter</th>
                            <th scope="row" style="text-align: center; width: 35vw">@item.url</th>
                            <th scope="row" style="text-align: center; width: 20vw">@item.requestTimeMid</th>
                            <th scope="row" style="text-align: center; width: 20vw">@item.requestTimeMin</th>
                            <th scope="row" style="text-align: center; width: 20vw">@item.requestTimeMax</th>
                        </tr>
                        {counter++;}
                    }

                </tbody>
            </table>

        </div>

    </form>

    <form action="History" method="post">

        <!--History loader (visible if history exists)-->
        <div class="btn-group dropup">
            <button type="button" style="margin-top: 10px" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                History
            </button>
            <div class="dropdown-menu">

                @foreach (var item in ViewBag.scans)
                {
                    <button type="submit" value="@item.ScanningUrl - @item.Date" name="history" style="width:500px" class="dropdown-item, form-control">
                        @item.ScanningUrl - @item.Date
                    </button>
                }

            </div>
        </div>
        

    </form>


</div>
